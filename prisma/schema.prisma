generator client {
  provider = "prisma-client-js"
  output   = "../lib/generated/client"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                  String        @id @default(uuid())
  name                String
  email               String?       @unique
  whatsapp            String?       @unique
  birthDate           String?
  password            String?
  role                UserRole      @default(CLIENTE)
  plan                UserPlan?     @default(PREMIUM)
  barbeiroId          String?
  isActive            Boolean       @default(true)
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
  subscriptionStatus  String?
  address             String?
  addressComplement   String?
  addressNumber       String?
  appointmentInterval Int?          @default(10)
  asaasCustomerId     String?       @unique
  asaasSubscriptionId String?       @unique
  city                String?
  cpfCnpj             String?
  endTime             String?       @default("18:00")
  image               String?
  inviteToken         String?       @unique
  lastRenewal         DateTime?
  nextRenewal         DateTime?
  offDays             String[]      @default([])
  phone               String?
  postalCode          String?
  province            String?
  resetToken          String?       @unique
  resetTokenExpiry    DateTime?
  startTime           String?       @default("09:00")
  workEndDate         String?
  workStartDate       String?
  barberAppointments  Appointment[] @relation("BarberAppointments")
  clientAppointments  Appointment[] @relation("ClientAppointments")
  transactions        Transaction[]
}

model Appointment {
  id          String       @id @default(uuid())
  date        DateTime
  clientId    String
  barberId    String
  serviceIds  String
  status      String       @default("PENDING")
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  barber      User         @relation("BarberAppointments", fields: [barberId], references: [id])
  client      User         @relation("ClientAppointments", fields: [clientId], references: [id])
  transaction Transaction?
}

model Service {
  id        String   @id @default(uuid())
  name      String
  price     Float
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Product {
  id          String   @id @default(uuid())
  name        String
  description String
  category    String
  price       Float
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  image       String?
  stock       Int      @default(0)
}

model ProductCategory {
  id        String   @id @default(uuid())
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Transaction {
  id                        String            @id @default(uuid())
  amount                    Float
  status                    TransactionStatus @default(PENDING)
  type                      TransactionType
  userId                    String
  appointmentId             String?           @unique
  createdAt                 DateTime          @default(now())
  updatedAt                 DateTime          @updatedAt
  asaasPaymentId            String?           @unique
  billingType               String?
  description               String?
  infinitePayOrderNSU       String?           @unique
  infinitePayReceiptUrl     String?
  infinitePaySlug           String?           @unique
  infinitePayTransactionNSU String?           @unique
  productId                 String?
  expiration_date           DateTime?
  appointment               Appointment?      @relation(fields: [appointmentId], references: [id])
  user                      User              @relation(fields: [userId], references: [id])
}

model Plan {
  id        String   @id @default(uuid())
  name      String
  price     Float
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum UserRole {
  CLIENTE
  BARBEIRO
  ADMIN
}

enum UserPlan {
  START
  PREMIUM
}

enum TransactionType {
  APPOINTMENT
  SUBSCRIPTION
  INCOME
  EXPENSE
}

enum TransactionStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
}
